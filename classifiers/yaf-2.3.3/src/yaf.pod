=pod

=head1 NAME

B<yaf> - Yet Another Flowmeter

=head1 SYNOPSIS

    yaf     [--in INPUT_SPECIFIER] [--out OUTPUT_SPECIFIER]
            [--live LIVE_TYPE] [--ipfix TRANSPORT_PROTOCOL]
            [--filter BPF_FILTER]
            [--rotate ROTATE_DELAY] [--lock] [--caplist]
            [--group SPREAD_GROUP_NAME(s)]
            [--groupby GROUPBY_TYPE]
            [--stats INTERVAL][--no-stats] [--noerror]
            [--dag-interface]
            [--napatech-interface]
            [--gre-decode] [--no-frag]
            [--max-frags FRAG_TABLE_MAX]
            [--ip4-only] [--ip6-only]
            [--idle-timeout IDLE_TIMEOUT]
            [--active-timeout ACTIVE_TIMEOUT]
            [--udp-temp-timeout TEMPLATE_TIMEOUT]
            [--force-read-all]
            [--flow-stats] [--delta]
            [--ingress INGRESS_INT] [--egress EGRESS_INT]
            [--max-payload PAYLOAD_OCTETS] [--udp-payload]
            [--max-flows FLOW_TABLE_MAX]
            [--export-payload] [--silk] [--udp-uniflow PORT]
            [--uniflow] [--mac] [--force-ip6-export]
            [--observation-domain DOMAIN_ID] [--entropy]
            [--applabel] [--applabel-rules RULES_FILE]
            [--ipfix-port PORT] [--tls] [--tls-ca CA_PEM_FILE]
            [--tls-cert CERT_PEM_FILE] [--tls-key KEY_PEM_FILE]
            [--become-user UNPRIVILEGED_USER]
            [--become-group UNPRIVILEGED_GROUP]
            [--log LOG_SPECIFIER] [--loglevel LOG_LEVEL]
            [--verbose] [--version]
            [--p0fprint] [--p0f-fingerprints FILENAME]
            [--fpexport]
            [--plugin-name LIBPLUGIN_NAME[,LIBPLUGIN_NAME...]]
            [--plugin-opts "OPTIONS[,OPTIONS...]"]
            [--plugin-conf CONF_FILE_PATH[,CONF_FILE_PATH...]]
            [--pcap PCAP_FILE_PREFIX] [--pcap-per-flow]
            [--max-pcap MAX_FILE_MB] [--pcap-timer PCAP_ROTATE_DELAY]
            [--pcap-meta-file META_FILENAME] [--index-pcap]

=head1 DESCRIPTION

B<yaf> is Yet Another Flowmeter and B<yaf> is a suite of tools to do flow metering.
B<yaf> is used as a sensor to capture flow information on a network and export that
information in IPFIX format. It reads packet data from B<pcap(3)> dumpfiles as
generated by B<tcpdump(1)>, from live capture from an interface using B<pcap(3)>,
an Endace DAG capture device, or a Napatech adapter, aggregates these packets
into flows, and exports flow records via IPFIX over SCTP, TCP or UDP, Spread, or into
serialized IPFIX message streams (IPFIX files) on the local file system.

Since B<yaf> is designed to be deployed on white-box sensors attached to local
network segments or span ports at symmetric routing points, it supports
bidirectional flow assembly natively. Biflow export is done via the export
method specified in B<RFC 5103> Bidirectional Flow Export using IPFIX. See the
B<OUTPUT> section below for information on this format.

B<yaf> also supports experimental partial payload capture, specifically for
banner-grabbing applications and protocol verification purposes.

The output of B<yaf> is designed to be collected and manipulated by flow
processing toolchains supporting IPFIX. The B<yafscii(1)> tool, which is
installed as part of B<yaf>, can also be used to print B<yaf> output in a
human-readable format somewhat reminiscient of B<tcpdump(1)>. B<yaf> output
can also be analyzed using the SiLK suite, and the B<nafalize(1)> tool, both
available from the CERT NetSA group.

=head1 OPTIONS

=head2 Input Options

These options control where B<yaf> will take its input from. B<yaf> can read packets
from a pcap dumpfile (as generated by B<tcpdump -w>) or live from an interface
via F<libpcap>, F<libdag>, or F<libpcapexpress> (Napatech Adapter library).
By default, if no input options are given, B<yaf> reads a pcap dumpfile
on standard input.

=over 4

=item B<--in> I<INPUT_SPECIFIER>

I<INPUT_SPECIFIER> is an input specifier. If B<--live> is given, this is the
name of an interface (e.g. C<eth0>, C<en0>, C<dag0>) to capture packets from.
Otherwise, it is a filename; the string B<-> may be used to read from
standard input (the default).

=item B<--caplist>

If present, treat the filename in I<INPUT_SPECIFIER> as an ordered
newline-delimited list of pathnames to B<pcap(3)> dumpfiles. Blank lines
and lines beginning with the character '#' within this are ignored. All
pathnames are evaluated with respect to the working directory B<yaf>
is run in. These dumpfiles are processed in order using the same flow
table, so they must be listed in ascending time order. This option is
intended to ease the use of yaf with rotated or otherwise split B<tcpdump(1)>
output.

=item B<--noerror>

Used with the B<--caplist> option.  When present, this prevents B<yaf> from
exiting when processing a list of dumpfiles in the middle due to an error
in a file.  B<yaf> will continue to process all files given in the
I<INPUT_SPECIFIER> despite errors within those files.

=item B<--live> I<LIVE_TYPE>

If present, capture packets from an interface named in the I<INPUT_SPECIFIER>.
I<LIVE_TYPE> is one of B<pcap> for packet capture via libpcap, or B<dag> for
packet capture via an Endace DAG interface using libdag, or B<napatech> for
packet capture via a Napatech Adapter using libpcapexpress. B<dag> is only
available if B<yaf> was built with Endace DAG support. B<napatech> is only
available if B<yaf> was built with libpcapexpress, a library maintained by nPulse
Technologies for use with a Napatech adapter.

=item B<--dag-interface>

If present, the interface on which a packet was received will be noted internally
within B<yaf>.  When flow records are exported from B<yaf>, an C<ingressinterface>
and an C<egressinterface> set of fields will be added to the output.  The
C<ingressinterface> field will be the physical interface which captured the packet
while the C<egressinterface> will be the physical interface | 0x100.  This can
be used to separate traffic based on DAG physical ports.  This option requires
building B<yaf> with the B<--enable-daginterface> switch.

=item B<--napatech-interface>

Similar to B<--dag-interface>, if present, the interface on which a packet was
received will be noted internally within B<yaf>.  When flow records are exported
from B<yaf>, an C<ingressinterface> and an C<egressinterface> set of fields will
be added to the output. The C<ingressinterface> field will be the physical interface
which captured the packet while the C<egressinterface> will be the the physical
interface | 0x100.  This can be used to separate traffic based on Napatech physical
ports.  This option requires building B<yaf> with the B<--enable-napatechinterface>
switch.

=item B<--filter> I<BPF_FILTER>

If present, enable Berkeley Packet Filtering (BPF) in B<yaf> with I<FILTER_EXPRESSION> as the incoming traffic filter.  Syntax of I<FILTER_EXPRESSION> follows the expression format described in the B<tcpdump(1)> man page.  This option is not currently supported if B<--live> is set to B<dag> or B<napatech> as BPF filtering is implemented with libpcap.  This option is also not supported on a Bivio due to the Bivio supplied version of libpcap that supports the zero-copy driver.

=back

=head2 Output Options

These options control where B<yaf> will send its output. B<yaf> can write flows
to an IPFIX file or export flows to an IPFIX collector over SCTP, TCP, UDP, or Spread.
By default, if no output options are given, B<yaf> writes an IPFIX file to
standard output.

=over 4

=item B<--out> I<OUTPUT_SPECIFIER>

I<OUTPUT_SPECIFIER> is an output specifier. If B<--ipfix> is present,
the I<OUTPUT_SPECIFIER> specifies the hostname or IP address of the
collector to which the flows will be exported. Otherwise, if B<--rotate>
is present, I<OUTPUT_SPECIFIER> is the prefix name of each output file
to write to. If B<--ipfix> is present and set to B<spread>, then I<OUTPUT_SPECIFIER> should be set to the name of the Spread daemon to connect to (See below examples of spread daemon names).  Otherwise, I<OUTPUT_SPECIFIER> is a filename in which the flows will be written; the string B<-> may be used to write to standard output (the default).

=item Examples

=over 1

=item Output to file

C<--out flows.yaf>

=item Output to collector on port 18000 at IP address 1.2.3.4

C<--out 1.2.3.4 --ipfix-port 18000 --ipfix tcp>

=item Connect to the Spread daemon named "4803" on the local machine

C<--out 4803 or --out 4803@localhost>

=item Connect to the machine identified by the domain name "host.domain.edu" on port 4803.

C<--out 4803@host.domain.edu>

=item Connect to the machine identified by the IP address "x.y.123.45" on port 18000.

C<--out x.y.123.45 --ipfix-port 18000>

=back

=item B<--ipfix> I<TRANSPORT_PROTOCOL>

If present, causes B<yaf> to operate as an IPFIX exporter, sending
IPFIX Messages via the specified transport protocol to the collector (e.g.,
SiLK's rwflowpack or flowcap facilities) named in the I<OUTPUT_SPECIFIER>.
Valid I<TRANSPORT_PROTOCOL> values are B<tcp>, B<udp>, B<sctp>, and B<spread>;
B<sctp> is only available if B<yaf> was built with SCTP support; B<spread> is only available if B<yaf> was built with Spread support. UDP is not recommended, as it is not a reliable transport protocol, and cannot guarantee delivery of messages.  As per the recommendations in RFC 5101, B<yaf> will retransmit templates three times within the template timeout period (configurable using B<--udp-temp-timeout> or by default, 10 minutes).  Use the
B<--ipfix-port>, B<--tls>, B<--tls-ca>, B<--tls-cert>, B<--tls-key>, B<--tls-pass>, and B<--group> options to further configure the connection to the
IPFIX collector.

=item B<--rotate> I<ROTATE_DELAY>

If present, causes B<yaf> to write output to multiple files, opening a new output
file every I<ROTATE_DELAY> seconds in the input data. Rotated files are named
using the prefix given in the I<OUTPUT_SPECIFIER>, followed by a suffix
containing a timestamp in C<YYYYMMDDhhmmss> format, a decimal serial number,
and the file extension B<.yaf>.

=item B<--lock>

Use lockfiles for concurrent file access protection on output files.
This is recommended for interoperating with the Airframe filedaemon
facility.

=item B<--stats> I<INTERVAL>

If present, causes B<yaf> to export process statistics every I<INTERVAL> seconds.
The default value for I<INTERVAL> is 300 seconds or every 5 minutes. B<yaf> uses IPFIX Options Templates and Records
to export flow, fragment, and decoding statistics.  If I<INTERVAL> is set
to zero, stats will not be exported.

=item B<--no-stats>

If present, B<yaf> will not export process statistics.  B<yaf> uses IPFIX
Options Templates and Records to export flow, fragment, and decoding
statistics.  B<--no-stats> takes precedence over B<--stats>.

=back

=head2 Decoder Options

These options are used to modify the B<yaf> packet decoder's behavior. None of
these options are required; the default behavior for each option when not
present is noted.

=over 4

=item B<--no-frag>

If present, ignore all fragmented packets. By default, B<yaf> will reassemble
fragments with a 30 second fragment timeout.

=item B<--max-frags> I<FRAG_TABLE_MAX>

If present, limit the number of outstanding, not-yet reassembled fragments
in the fragment table to I<FRAG_TABLE_MAX> by prematurely expiring fragments
from the table. This option is provided to limit B<yaf> resource usage when
operating on data from very large networks or networks with abnormal
fragmentation. The fragment table may exceed this limit slightly due
to limits on how often B<yaf> prunes the fragment table (every 5 seconds).
By default, there is no fragment table limit, and the fragment
table can grow to resource exhaustion.

=item B<--ip4-only>

If present, ignore all IPv6 packets and export IPv4 flows only.  The default is
to process both IPv4 and IPv6 packets.

=item B<--ip6-only>

If present, ignore all IPv4 packets and export IPv6 flows only.  The default is
to process both IPv4 and IPv6 packets.

=item B<--gre-decode>

If present, attempt to decode GRE version 0 encapsulated packets. Flows will
be created from packets within the GRE tunnels. Undecodeable GRE packets will
be dropped. Without this option, GRE traffic is exported as IP protocol 47
flows. This option is presently experimental.

=back

=head2 Flow Table Options

These options are used to modify the flow table behavior within B<yaf>. None of
these options are required; the default behavior for each option when not
present is noted.

=over 4

=item B<--idle-timeout> I<IDLE_TIMEOUT>

Set flow idle timeout in seconds. Flows are considered idle and flushed
from the flow table if no packets are received for I<IDLE_TIMEOUT> seconds.
The default flow idle timeout is 300 seconds (5 minutes).

=item B<--active-timeout> I<ACTIVE_TIMEOUT>

Set flow active timeout in seconds. Any flow lasting longer than
I<ACTIVE_TIMEOUT> seconds will be flushed from the flow table.
The default flow active timeout is 1800 seconds (30 minutes).

=item B<--udp-temp-timeout> I<TEMPLATE_TIMEOUT>

Set UDP template timeout in seconds if B<--ipfix> is set to I<udp>.  As per RFC 5101 recommendations, B<yaf>
will attempt to export templates three times within I<TEMPLATE_TIMEOUT>.  The
default template timeout period is 600 seconds (10 minutes).

=item B<--max-payload> I<PAYLOAD_OCTETS>

If present, capture at most I<PAYLOAD_OCTETS> octets from the start of
each direction of each flow. Non-TCP flows will only capture payload
from the first packet unless B<--udp-payload> is set. If not present, B<yaf> will not attempt to capture
payload. Payload capture must be enabled for payload export
(B<--export-payload>), application labeling (B<--applabel>), and entropy
evaluation (B<--entropy>). Note that payload capture is still an
experimental feature.

=item B<--max-flows> I<FLOW_TABLE_MAX>

If present, limit the number of open flows in the flow table to
I<FLOW_TABLE_MAX> by prematurely expiring the flows with the least
recently received packets; this is analogous to an adaptive idle
timeout. This option is provided to limit B<yaf> resource usage when
operating on data from large networks. By default, there is no flow
table limit, and the flow table can grow to resource exhaustion.

=item B<--udp-payload>

If present, capture at most I<PAYLOAD_OCTETS> octets fom the start of each direction of each UDP flow, where I<PAYLOAD_OCTETS> is set using the B<--max-payload> flag.

=item B<--silk>

If present, export flows in "SiLK mode". As of B<yaf> 2.0, this will export
TCP information (flags, ISN) in the main flow record instead of within the
SubTemplateMultiList.  This flag must be used when exporting to SiLK for it to
collect TCP flow information.  This also introduces the following incompatibilities
with standard IPFIX export:

=over 4

=item *

totalOctetCount and reverseTotalOctetCount are clamped to 32 bits. Any packet
that would cause either of these counters to overflow 32 bits will cause the
flow to close with flowEndReason 0x02 (active timeout), and will become the
first packet of a new flow. This is analogous to forcing an active timeout
when the octet counters overflow.

=item *

The high-order bit of the flowEndReason IE is set on any flow created on a
counter overflow, as above.

=item *

The high-order bit of the flowEndReason IE is set on any flow created on an
active timeout.

=back

Since this changes the semantics of the exported flowEndReason IE, it should
only be used when generating flows and exporting to rwflowpack, flowcap, or
writing files for processing with rwipfix2silk.

=item B<--force-read-all>

If present, B<yaf> will process out-of-sequence packets.  However, it will
still reject out-of-sequence fragments.

=back

=head2 Export Options

These options are used to modify the the data exported by B<yaf>.

=over 4

=item B<--export-payload>

If present, export at most I<PAYLOAD_OCTETS> (the argument to
B<--max-payload>) octets from the start of each direction of each
flow. Non-TCP flows will only export payload from the first packet. By default,
B<yaf> will not export flow payload.

=item B<--uniflow>

If present, export biflows using the Record Adjacency method in
section 3 of RFC 5103. This is useful when exporting to IPFIX
Collecting Processes that are not biflow-aware.

=item B<--mac>

If present, export MAC-layer information; presently, exports source and destination MAC addresses.

=item B<--force-ip6-export>

If present, force IPv4 flows to be exported with IPv6-mapped IPv4 addresses in
::FFFF/96. This will cause all flows to appear to be IPv6 flows.

=item B<--observation-domain> I<DOMAIN_ID>

Set the observationDomainID on each exported IPFIX message to the given
integer value. If not present, the observationDomainId defaults to 0.  This
value is also used as the exportingProcessId in the B<yaf> statistics Option
Record as a Scope Field.

=item B<--udp-uniflow> I<PORT>

If present, export each UDP packet on the given port (or 1 for all ports) as a single flow, with flowEndReason set to YAF_END_UDPFORCE (0x1F).  This will not close the flow. The flow will stay open until it closes naturally by the idle and active timeouts.  Most useful with B<--export-payload> in order to export every UDP payload on a specific port.

=item B<--flow-stats>

If present, export extra flow attributes and statistics in the
subTemplateMultiList field.  This will maintain information such as small
packet count, large packet count, nonempty packet count, average
interarrival times, total data octets, and max packet size.  See the flow
statistics template below for more information about each of the fields B<yaf>
exports.

=item B<--delta>

If present, export octet and packet total counts in the delta count information
elements.  octetTotalCount will be exported in octetDeltaCount (IE 1), 
reverseOctetTotalCount will be exported in reverseOctetDeltaCount.  packetTotalCount
will be exported in packetDeltaCount (IE 2), and reversePacketTotalCount will be
exported in reversePacketDeltaCount. 

=item B<--ingress> I<INGRESS_INT>

If present, set the ingressInterface field in the flow template to I<INGRESS_INT>.  
This field will also be populated if B<yaf> was configured with --enable-daginterface or
--enable-napatechinterface or --with-bivio.  If yaf is running on a dag, napatech, or 
bivio, and the physical interface is available, this value will override I<INGRESS_INT>.

=item B<--egress> I<EGRESS_INT>

If present, set the egressInterface field in the flow template to I<EGRESS_INT>.
This field will also be populated if B<yaf> was configured with --enable-daginterface
or --enable-napatechinterface or --with-bivio. If yaf is running on a dag, napatech, or
bivio, and the physical interface is available, this value will override I<EGRESS_INT>.

=back

=head2 Application Labeler Options

If B<yaf> is built with application labeler support enabled (using the
B<--enable-applabel> option to B<./configure> when B<yaf> is built), then
B<yaf> can examine packet payloads and determine the application protocol
in use within a flow, and export a 16-bit application label with
each flow.

The exported application label uses the common port number for the
protocol.  For example, HTTP traffic, independent of what port the
traffic is detected on, will be labeled with a value of 80, the
default HTTP port.  Labels and rules are taken from a configuration
file read at B<yaf> startup time.

Application labeling requires payload capture to be enabled with the
B<--max-payload> option. A minimum payload capture length of 384
octets is recommended for best results.

Application labeling is presently experimental. SiLK does support
IPFIX import and translation of the application label via
B<rwflowpack>, B<flowcap>, and B<rwipfix2silk>.

=over 4

=item B<--applabel>

If present, export application label data. Requires B<--max-payload>
to enable payload capture.

=item B<--applabel-rules> I<RULES_FILE>

Read application labeler rules from I<RULES_FILE>. If not present,
rules are read by default from F</Users/coulls/Documents/Research/Traffic_Analysis/code/trunk/test-suite/classifiers/opt/etc/yafApplabelRules.conf>.

=back

=head2 Entropy Measurement

If B<yaf> is built with entropy measurement enabled (using the
B<--enable-entropy> option to B<./configure> when B<yaf> is built,)
then B<yaf> can examine the packet payloads and determine a Shannon
Entropy value for the payload.  The entropy calculation does not
include the network (IP) or transport (UDP/TCP) headers.  The entropy
is calculated in terms of bits per byte, (log base 2.)  The
calculation generates a real number value between 0.0 and 8.0.  That
number is then converted into an 8-bit integer value between 0 and
255.  Roughly, numbers above 230 are generally compressed (or encrypted)
and numbers centered around approximately 140 are English text.  Lower
numbers carry even less information content.  Another useful piece of
information is that SSL/TLS tends to zero pad its packets, which causes
the entropy of those flows to drop quite low.

=over 4

=item B<--entropy>

If present, export the entropy values for both the forward and reverse
payloads.  Requires the B<--max-payload> option to operate.

=back


=head2 IPFIX Connection Options

These options are used to configure the connection to an IPFIX collector.

=over 4

=item B<--ipfix-port> I<PORT>

If B<--ipfix> is present, export flows to TCP, UDP, or SCTP port I<PORT>.
If not present, the default IPFIX port 4739 is used. If B<--tls> is also
present, the default secure IPFIX port 4740 is used.

=item B<--tls>

If B<--ipfix> is present, use TLS to secure the connection to the
IPFIX collector. Requires the I<TRANSPORT_PROTOCOL> to be B<tcp>, as DTLS over
UDP or SCTP is not yet supported. Requires the B<--tls-ca>, B<--tls-cert>, and
B<--tls-key> options to specify the X.509 certificate and TLS key information.

=item B<--tls-ca> I<CA_PEM_FILE>

Use the Certificate Authority or Authorities in I<CA_PEM_FILE> to verify the
remote IPFIX Collecting Process' X.509 certificate. The connection to the
Collecting Process will fail if its certificate was not signed by this CA
(or by a certificate signed by this CA, recursively); this prevents export to
unauthorized Collecting Processes. Required if B<--tls> is present.

=item B<--tls-cert> I<CERT_PEM_FILE>

Use the X.509 certificate in I<CERT_PEM_FILE> to identify this IPFIX Exporting
Process. This certificate should contain the public part of the private key in
I<KEY_PEM_FILE>. Required if B<--tls> is present.

=item B<--tls-key> I<KEY_PEM_FILE>

Use the private key in I<KEY_PEM_FILE> for this IPFIX Exporting Process. This
key should contain the private part of the public key in
I<CERT_PEM_FILE>. Required if B<--tls> is present. If the key is encrypted,
the password must be present in the YAF_TLS_PASS environment variable.

=item B<--group> I<SPREAD_GROUP_NAME>

If B<--ipfix> is present and set to B<spread>, use B<--group> to specify the spread group name(s) to publish output.
It is possible to list more than one group name in a comma-seperated list.
To use Spread as a manifold for different types of flows, use the format
I<GROUP, GROUP_NAME:VALUE, GROUP_NAME:VALUE> as the argument to B<--group>
and use the B<--groupby> switch.  This list should be contained in quotes if it contains spaces (B<yaf> will ignore spaces in quotes). It is suggested to use one group
as the catchall for all flows (no value listed) so flows are not lost.
The B<--groupby> switch must be used if B<--group> uses GROUP:VALUE
format. See the Spread Documentation, www.spread.org,
for more details on Spread.

=item B<--groupby> I<GROUPBY_TYPE>

If B<--group> is used with group values, use B<--groupby> to specify what
type of value should be used.  Options are I<port, vlan, applabel, protocol, version>.
B<--groupby> accepts only one argument.   The I<port> option is destination
transport port of the flow.  I<version> is the IP version of the flow.

=back

=head2 Privilege Options

These options are used to cause B<yaf> to drop privileges when running as root
for live capture purposes.

=over 4

=item B<--become-user> I<UNPRIVILEGED_USER>

After opening the live capture device in B<--live> mode, drop
privilege to the named user. Using B<--become-user> requires B<yaf> to
be run  as root or setuid root. This option will cause all files
written by B<yaf> to be owned by the user I<UNPRIVILEGED_USER> and the
user's primary group; use B<--become-group> as well to change the group
B<yaf> runs as for output purposes.

If running as root for live capture purposes and B<--become-user> is not
present, B<yaf> will warn that privilege is not being dropped. We highly
recommend the use of this option, especially in production environments,
for security purposes.

=item B<--become-group> I<UNPRIVILEGED_GROUP>

B<--become-group> can be used to change the group from the default of
the user given in B<--become-user>.  This option has no effect if
given without the B<--become-user> option as well.

=back

=head2 PCAP Options

These options are used to turn on and configure B<yaf>'s PCAP export
capability.

=over 4

=item B<--pcap> I<PCAP_FILE_PREFIX>

This option turns on PCAP export in B<yaf>.  It will capture and write
packets for all network traffic B<yaf> has received and processed to
PCAP files with the given I<PCAP_FILE_PREFIX>.  B<yaf> will not create file
directories. If B<yaf> can't write to the file, B<yaf> will turn off PCAP
export. Pcap files will have names in the form of
PCAP_FILE_PREFIX[datetime]_serialno.pcap".  B<yaf> will write to a file until the
file size has reached B<--max-pcap> or every B<--pcap-timer> seconds
(whichever happens first). By default, B<yaf> rotates files every 5 MB. Files
will be "locked" (".lock" will be appended to the filename) until B<yaf> has
closed the file. Be aware that your Operating System will have a limit on the
maximum number of files in a directory and a maximum file size.  If this
limit is reached, B<yaf> will write warning messages and terminate PCAP export.
This may effect flow generation if B<yaf> is also writing IPFIX files.
Optionally, you can also export meta information about the flows in each
rolling PCAP file with the B<--pcap-meta-file> switch.

=item B<--pcap-per-flow>

If present, B<yaf> will write a pcap file for each flow in the output
directory given to B<--pcap>.  PCAP_FILE_PREFIX given to B<--pcap> must be
a file directory.  This option is experimental and should only be
used when reading pcap files of reasonable size.  B<yaf> only writes up to
B<--max-payload> bytes of each packet to the pcap file.  Therefore,
B<--max-payload> must be set to an appropriate size to prevent packets from
being truncated in the pcap file.  B<yaf> will use the
last three digits of the flowStartMilliseconds as the directory and the
flow key hash, flowStartMilliseconds, and serial number as the filename.
See the included
getFlowKeyHash program to easily calculate the name of the file for a given
flow.  When the pcap file has reached B<--max-pcap> size, B<yaf> will close
the file, increment the serial number, and open a new pcap file with the same
naming convention. Note that your operating system has a limit to the number
of open file handles B<yaf> can maintain at any given time.  Therefore, the
performance of B<yaf> degrades when the number of open flows is greater than
the maximum number of file handles.

=item B<--max-pcap> I<MAX_FILE_MB>

If present, set the maximum file size of pcap files to I<MAX_FILE_MB> MB.
The default is 5 MB.

=item B<--pcap-timer> I<PCAP_ROTATE_DELAY>

If present, B<yaf> will rotate rolling pcap files every I<PCAP_ROTATE_DELAY>
seconds or when the file reaches B<--max-pcap> size, whichever happens first.
By default, B<yaf> only rotates files based on file size.

=item B<--pcap-meta-file> I<META_FILENAME>

If present and --pcap is also present, B<yaf> will export metadata 
on the flows contained in
each rolling pcap file B<yaf> is writing to the filename specified by I<META_FILENAME>.  B<yaf>
will write a line in the form:

=over 1

=item I<flow_key_hash | flowStartMilliseconds | pcap_file_name> 

=back

for each flow in the pcap.  If a flow exists across 3 pcap
files, there will be 3 lines in I<META_FILENAME> for that flow (each line
having a different filename).  The pcap-meta-file will rotate files every 10
rolling pcap files.  A new file will be created in the form I<META_FILENAME>x
where x starts at 1 and increments by 1 for every new pcap-meta-file created.
This file can be uploaded to a database for flow correlation and flow-to-pcap
analysis.

If B<--pcap-meta-file> is present and --pcap is not present, 
B<yaf> will export information about the
pcap file(s) it is presently reading, as opposed to the pcap files B<yaf> is writing.
For each packet in the pcap file, B<yaf> will write a line in the form:

=over 1

=item I<flow_key_hash | flowStartMilliseconds | file_num | offset | length>

=back

C<file_num> is the sequential file number that B<yaf> has processed.  If B<yaf>
was given a single pcap file, this number will always be 0.
C<offset> is the offset into the pcap file of the beginning of the packet,
at the start of the pcap packet header. C<length> is the length of the packet including
the pcap packet header. 
Using this offset, a separate program would be able to quickly extract packets
for a flow. This file only rotates if I<META_FILE> reaches max size.

=item B<--index-pcap>

If present and B<--pcap> and B<--pcap-meta-file> are also present, 
export offset and length information about the packets B<yaf> is 
writing to the rolling pcap files.  Adding this option will force
B<yaf> to write one line per packet to the B<pcap-meta-file> in the form:

=over 1

=item I<flow_key_hash | flowStartMilliseconds | pcap_file_name | offset | length>

=back

=back

=head2 Logging Options

These options are used to specify how log messages are routed. B<yaf> can
log to standard error, regular files, or the UNIX syslog facility.

=over 4

=item B<--log> I<LOG_SPECIFIER>

Specifies destination for log messages. I<LOG_SPECIFIER> can be a syslog(3)
facility name, the special value B<stderr> for standard error, or the
I<absolute> path to a file for file logging. The default log
specifier is B<stderr> if available, B<user> otherwise.

=item B<--loglevel> I<LOG_LEVEL>

Specify minimum level for logged messages. In increasing levels of verbosity,
the supported log levels are B<quiet>, B<error>, B<critical>, B<warning>,
B<message>, B<info>, and B<debug>. The default logging level is B<warning>.

=item B<--verbose>

Equivalent to B<--loglevel debug>.

=item B<--version>

If present, print version and copyright information to standard error and exit.

=back

=head2 Plugin Options

These options are used to load, configure, and run a B<yaf> plugin.

=over 4

=item B<--plugin-name> I<LIBPLUGIN_NAME[,LIBPLUGIN_NAME...]>

Specify the plugin to load.  The loaded plugin must follow the B<yaf> plugin framework.  I<LIBPLUGIN_NAME> must be the full path to the plugin library name.  Two plugins are included with c<yaf>, a Deep Packet Inspection plugin, and a
DHCP Fingerprinting plugin. This flag will only be recognized if B<yaf> is configured with B<--enable-plugins>. There are also configure options to export only DNS Authoritative and NXDomain responses. Read each plugin's documentation
for more information.

=item B<--plugin-opts> I<"OPTIONS[,OPTIONS...]">

Specify the arguments to the plugin given to B<--plugin-name>.  This flag will only be recognized if B<yaf> is configured with B<--enable-plugins> and B<--plugin-name> is set to a valid plugin.  For example, the DPI Plugin takes the well-known port of a protocol(s) to enable DPI (default for DPI is all protocols).

=item B<--plugin-conf> I<CONF_FILE_PATH[,CONF_FILE_PATH...]>

Specify the path to a configuration file for the plugin given to B<--plugin-name>.  This flag will only be recognized if
B<yaf> is configured with B<--enable-plugins> and B<--plugin-name> is set to a valid plugin.  If this switch is not used,
but the plugin requires a configuration file, the default location F</Users/coulls/Documents/Research/Traffic_Analysis/code/trunk/test-suite/classifiers/opt/etc> will be used.

=back


=head2 Passive OS Fingerprinting (p0f)

These options are used to enable p0f in B<yaf>. p0f is presently experimental.  There is no support in B<yafscii> or SiLK for printing p0f related data.  Currently, B<yaf> uses the p0f Version 2 SYN fingerprints (see p0f.fp).

=over 4

=item B<--p0fprint>

If present, export p0f data.  This data consists of three related information elements; osName, osVersion, osFingerPrint.  This flag requires B<yaf> to be configured with B<--enable-p0fprinter>.

=item B<--p0f-fingerprints>

Location of the p0f fingerprint file(s), p0f.fp.  Default is F</Users/coulls/Documents/Research/Traffic_Analysis/code/trunk/test-suite/classifiers/opt/etc/p0f.fp>.  This version of 
B<yaf> includes the updated CERT p0f fingerprints.  See E<lt>https://tools.netsa.cert.org/confluence/display/tt/p0f+fingerprintsE<gt> for updates.

=item B<--fpexport>

If present, enable export of handshake headers for external OS fingerprinters.  The related information elements are firstPacketBanner and secondPacketBanner.  This flag requires B<yaf> to be configured with B<--enable-fpexporter>.

=back

=head1 OUTPUT X<OUTPUT>

=head2 Basic Flow Record

B<yaf>'s output consists of an IPFIX message stream. B<yaf> uses a variety of
templates for IPFIX data records; the information elements that may appear
in these templates are enumerated below. For further information about the IPFIX
information model and IPFIX message stream, see B<RFC 5102>, B<RFC 5101>, and
B<RFC 5103>.  As of B<yaf> 2.0, B<yaf> nests some templates in an IPFIX
subTemplateMultiList.  In order to retain compatibility with the SiLK Tools,
use B<--silk> to prevent B<yaf> from nesting TCP Information Elements.  Below
are descriptions of each of the templates B<yaf> will export.  See the
Internet-Draft B<Export of Structured Data in IPFIX> for more information on IPFIX lists.

B<yaf> assigns information element numbers to reverse flow elements in biflow
capture based on the standard IPFIX PEN 29305.  This applies only for
information elements defined in the standard IPFIX Information Model
(B<RFC 5102>) that do not have a reverse information element already defined.
For information elements defined under the CERT PEN, a standard method is
used to calculate their reverse element identifier.  The method is that
bit fourteen is set to one in the IE field, (e.g. 16384 + the forward IE number.)

=over 4

=item B<flowStartMilliseconds> IE 152, 8 octets, unsigned

Flow start time in milliseconds since 1970-01-01 00:00:00 UTC. Always present.

=item B<flowEndMilliseconds> IE 153, 8 octets, unsigned

Flow end time in milliseconds since 1970-01-01 00:00:00 UTC. Always present.

=item B<octetTotalCount> IE 85, 8 octets, unsigned

Number of octets in packets in forward direction of flow. Always present.
May be encoded in 4 octets using IPFIX reduced-length encoding.

=item B<reverseOctetTotalCount> Reverse (PEN 29305) IE 85, 8 octets, unsigned

Number of octets in packets in reverse direction of flow. Present if flow
has a reverse direction. May be encoded in 4 octets using IPFIX
reduced-length encoding.

=item B<packetTotalCount> IE 86, 8 octets, unsigned

Number of packets in forward direction of flow. Always present.
May be encoded in 4 octets using IPFIX reduced-length encoding.

=item B<reversePacketTotalCount> Reverse (PEN 29305) IE 86, 8 octets, unsigned

Number of packets in reverse direction of flow. Present if flow has a
reverse direction. May be encoded in 4 octets using IPFIX reduced-length
encoding.

=item B<reverseFlowDeltaMilliseconds> CERT (PEN 6871) IE 21, 4 octets, unsigned

Difference in time in milliseconds between first packet in forward direction
and first packet in reverse direction. Correlates with (but does not
necessarily represent) round-trip time. Present if flow has a reverse
direction.

=item B<sourceIPv4Address> IE 8, 4 octets, unisigned

IPv4 address of flow source or biflow initiator. Present for IPv4
flows without IPv6-mapped addresses only.

=item B<destinationIPv4Address> IE 12, 4 octets, unsigned

IPv4 address of flow source or biflow responder. Present for IPv4
flows without IPv6-mapped addresses only.

=item B<sourceIPv6Address> IE 27, 16 octets, unsigned

IPv6 address of flow source or biflow initiator. Present for IPv6
flows or IPv6-mapped IPv4 flows only.

=item B<destinationIPv6Address> IE 28, 16 octets, unsigned

IPv6 address of flow source or biflow responder. Present for IPv6
flows or IPv6-mapped IPv4 flows only.

=item B<sourceTransportPort> IE 7, 2 octets, unsigned

TCP or UDP port on the flow source or biflow initiator endpoint.
Always present.

=item B<destinationTransportPort> IE 11, 2 octets, usigned

TCP or UDP port on the flow destination or biflow responder endpoint.
Always present. For ICMP flows, contains ICMP type * 256 + ICMP code.
This is non-standard, and an open issue in B<yaf>.

=item B<flowAttributes> CERT (PEN 6871) IE 40, 2 octets, unsigned

Miscellaneous flow attributes for the forward direction of the flow.
Always present (B<yaf> 2.1 or later).  Current flag values:

=over 2

=item Bit 1: All packets in the forward direction have fixed size

=item Bit 2: Packet(s) in the forward direction was received out-of-sequence

=back

=item B<reverseFlowAttributes> CERT (PEN 6871) IE 16424, 2 octets, unsigned

Miscellaneous flow attributes for the reverse direction of the flow.
Always present (B<yaf> 2.1 or later).  Current flag values:

=over 2

=item Bit 1: All packets in the reverse direction have fixed size

=item Bit 2: Packet(s) in the reverse direction was received out-of-sequence

=back

=item B<protocolIdentifier> IE 4, 1 octet, unsigned

IP protocol of the flow. Always present.

=item B<flowEndReason> IE 136, 1 octet, unsigned

Flow end reason code, as defined by the IPFIX Information Model.
Always present. In B<--silk> mode, the high-order bit is set if the flow
was created by continuation.

=item B<silkAppLabel> CERT (PEN 6871) IE 33, 2 octets, unsigned

Application label, defined as the primary well-known port associated
with a given application. Present if the application labeler is
enabled, and was able to determine the application protocol used
within the flow.

=item B<vlanId> IE 58, 2 octets, unsigned

802.1q VLAN tag of the first packet in the forward direction of the flow.

=item B<reverseVlanId> Reverse (PEN 29305) IE 58, 2 octets, unsigned

802.1q VLAN tag of the first packet in the reverse direction of the flow.
Present if the flow has a reverse direction.

=item B<ingressInterface> IE 10, 4 octets, unsigned

The index of the IP interface where packets of this flow are being received.
Use --ingress, --napatech-interface, --dag-interface or configure B<yaf> with
bivio for this field to be present in the flow template.  Use --ingress to
manually set this field.

=item B<egressInterface> IE 14, 4 octets, unsigned

The index of the IP interface where packets of this flow are being received.
Use --egress, --napatech-interface, --dag-interface or configure B<yaf> with
bivio for this field to be present in the flow template. If using napatech, dag,
or bivio, C<egressinterface> will be the physical interface | 0x100.  Use --egress
to manually set this field.

=item B<subTemplateMultiList> IE 293, variable length

Represents a list of zero or more instances of a structured data type, where
the data type of each list element can be different and corresponds with
different template definitions.  The Information Element Number will change
upon updates to the IPFIX lists specification and libfixbuf releases.

=back

=head2 TCP Flow Template

The following six Information Elements will be exported as a template
within the subTemplateMultiList unless B<--silk> is used.

=over 4

=item B<tcpSequenceNumber> IE 184, 4 octets, unsigned

Initial sequence number of the forward direction of the flow. Present if
the flow's protocolIdentifier is 6 (TCP).  This element is contained in the
B<yaf> TCP template within the subTemplateMultiList unless B<--silk> is used.

=item B<reverseTcpSequenceNumber> Reverse (PEN 29305) IE 184, 4 octets, unsigned

Initial sequence number of the reverse direction of the flow. Present if the
flow's protocolIdentifier is 6 (TCP) and the flow has a reverse direction.
This element is contained in the B<yaf> TCP template within the subTemplateMultiList unless B<--silk> is used.

=item B<initialTCPFlags> CERT (PEN 6871) IE 14, 1 octet, unsigned

TCP flags of initial packet in the forward direction of the flow.
Present if the flow's protocolIdentifier is 6 (TCP). This element is contained
in the B<yaf> TCP template within the subTemplateMultiList unless B<--silk> is used.

=item B<unionTCPFlags> CERT (PEN 6871) IE 15, 1 octet, unsigned

Union of TCP flags of all packets other than the initial packet
in the forward direction of the flow. Present if the flow's
protocolIdentifier is 6 (TCP). This element is contained in the
B<yaf> TCP template within the subTemplateMultiList unless B<--silk> is used.

=item B<reverseInitialTCPFlags> CERT (PEN 6871) IE 16398, 1 octet, unsigned

TCP flags of initial packet in the reverse direction of the flow.
Present if the flow's protocolIdentifier is 6 (TCP) and the flow
has a reverse direction. This element is contained in the
B<yaf> TCP template within the subTemplateMultiList unless B<--silk> is used.

=item B<reverseUnionTCPFlags> CERT (PEN 6871) IE 16399, 1 octet, unsigned

Union of TCP flags of all packets other than the initial packet
in the reverse direction of the flow. Present if the flow's
protocolIdentifier is 6 (TCP) and the flow has a reverse direction.
This element is contained in the B<yaf> TCP template within the subTemplateMultiList unless B<--silk> is used.

=back

=head2 MAC Flow Template

The following two Information Elements will be exported as a template
within the subTemplateMultiList.

=over 4

=item B<sourceMacAddress>, IE 56, 6 octets, unsigned

Source MAC Address of the first packet in the forward direction of the flow.
This element is contained in the B<yaf> MAC template within the subTemplateMultiList.

=item B<destinationMacAddress>, IE 80, 6 octets, unsigned

Destination MAC Address of the first packet in the reverse direction of the flow. This element is contained in the B<yaf> MAC template within the subTemplateMultiList.

=back

=head2 Payload Flow Template

The following two Information Elements will be exported as a template
within the subTemplateMultiList.

=over 4

=item B<payload> CERT (PEN 6871) IE 18, variable-length

Initial I<n> bytes of forward direction of flow payload.
Present if payload collection is enabled and payload is present
in the forward direction of the flow. This element is contained in the
B<yaf> Payload template within the subTemplateMultiList.

=item B<reversePayload> CERT (PEN 6871) IE 16402, variable-length

Initial I<n> bytes of reverse direction of flow payload.
Present if payload collection is enabled and payload is present
in the reverse direction of the flow. This element is contained in the B<yaf>
Payload template within the subTemplateMultiList.

=back

=head2 Entropy Flow Template

The following two Information Elements will be exported as a template
within the subTemplateMultiList.

=over 4

=item B<payloadEntropy> CERT (PEN 6871) IE 35, 1 octet, unsigned

Shannon Entropy calculation of the forward payload data. This element is
contained in the B<yaf> Entropy template within the subTemplateMultiList.

=item B<reversePayloadEntropy> CERT (PEN 6871) IE 16419, 1 octet, unsigned

Shannon Entropy calculation of the reverse payload data.  This element is
contained in the B<yaf> Entropy template within the subTemplateMultiList.

=back

=head2 p0f Flow Template

The following six Information Elements will be exported as a template
within the subTemplateMultiList if present and only if p0f is enabled.

=over 4

=item B<osName> CERT (PEN 6871) IE 36, variable-length

p0f OS Name for the forward flow based on the SYN packet and p0f SYN Fingerprints.  Present only if p0f is enabled.  This element is contained in the B<yaf>
p0f template within the subTemplateMultiList.

=item B<reverseOsName> CERT (PEN 6871) IE 16420, variable-length

p0f OS Name for the reverse flow based on the SYN packet and p0f SYN Fingerprints.  Present only if p0f is enabled. This element is contained in the B<yaf>
p0f template within the subTemplateMultiList.

=item B<osVersion> CERT (PEN 6871) IE 37, variable-length

p0f OS Version for the forward flow based on the SYN packet and p0f SYN Fingerprints.  Present only if p0f is enabled. This element is contained in the
B<yaf> p0f template within the subTemplateMultiList.

=item B<reverseOsVersion> CERT (PEN 6871) IE 16421, variable-length

p0f OS Version for the reverse flow based on the SYN packet and p0f SYN fingerprints.  Present only if p0f is enabled. This element is contained in the
B<yaf> p0f template within the subTemplateMultiList.

=item B<osFingerPrint> CERT (PEN 6871) IE 107, variable-length

p0f OS Fingerprint for the forward flow based on the SYN packet and p0f SYN fingerprints.  Present only if p0f is enabled. This element is contained in the B<yaf> p0f template within the subTemplateMultiList.

=item B<reverseOsFingerPrint> CERT (PEN 6871) IE 16491, variable-length

p0f OS Fingerprint for the reverse flow based on the SYN packet and p0f SYN Fingerprints. Present only if p0f is enabled. This element is contained in the B<yaf> p0f template within the subTemplateMultiList.

=back

=head2 Fingerprint Exporting Template

The following four Information Elements will be exported as a template
within the subTemplateMultiList if present and only if fpexport is enabled.

=over 4

=item B<firstPacketBanner> CERT (PEN 6871) IE 38, variable-length

IP and transport headers for first packet in forward direction to be used for external OS Fingerprinters.  Present only if fpexport is enabled. This element is contained in the B<yaf> FPExport template within the subTemplateMultiList.

=item B<reverseFirstPacketBanner> CERT (PEN 6871) IE 16422, variable-length

IP and transport headers for first packet in reverse direction to be used for external OS Fingerprinters.  Present only if fpexport is enabled. This element is contained in the B<yaf> FPExport template within the subTemplateMultiList.

=item B<secondPacketBanner> CERT (PEN 6871) IE 39, variable-length

IP and transport headers for second packet in forward direction (third packet in sequence) to be used for external OS Fingerprinters.  Present only if fpexport is enabled. This element is contained in the B<yaf> FPExport template within the subTemplateMultiList.

=item B<reverseSecondPacketBanner> CERT (PEN 6871) IE 16423, variable-length

IP and transport headers for second packet in reverse direction (currently not used).  Present only if fpexport is enabled. This element is contained in the B<yaf> FPExport template within the subTemplateMultiList.

=back

=head2 Hooks Templates

B<yaf> can export other templates within the subTemplateMultiList
if plugins are enabled in B<yaf>.  See B<yafdpi(1)> for descriptions
of the B<yaf> Deep Packet Inspection Information Elements.  See B<yafdhcp(1)>
for descriptions of the DHCP Fingerprint Information Elements.

=head2 Flow Statistics Template

B<yaf> can maintain and export more information about each flow than what
is exported in the Basic Flow Template.  If B<yaf> is run with B<--flow-stats>
B<yaf> will export the following attributes with every flow as long as one
of the following characteristics is nonzero. The following flow attributes
have been known to help in traffic classification.

=over 4

=item B<dataByteCount> CERT (PEN 6871) IE 502, 8 octets, unsigned

Total bytes transferred as payload.

=item B<averageInterarrivalTime> CERT (PEN 6871) IE 503, 8 octets, unsigned

Average number of milliseconds between packets.

=item B<standardDeviationInterarrivalTime> CERT (PEN 6871) IE 504, 8 octets, unsigned

Standard deviation of the interarrival time for up to the first ten packets.

=item B<tcpUrgTotalCount> CERT (PEN 6871) IE 509, 4 octets, unsigned

The number of TCP packets that have the URGENT Flag set.

=item B<smallPacketCount> CERT (PEN 6871) IE 500, 4 octets, unsigned

The number of packets that contain less than 60 bytes of payload.

=item B<nonEmptyPacketCount> CERT (PEN 6871) IE 501, 4 octets, unsigned

The number of packets that contain at least 1 byte of payload.

=item B<largePacketCount> CERT (PEN 6871) IE 510, 4 octets, unsigned

The number of packets that contain at least 220 bytes of payload.

=item B<firstNonEmptyPacketSize> CERT (PEN 6871) IE 505, 2 octets, unsigned

Payload length of the first non-empty packet.

=item B<maxPacketSize> CERT (PEN 6871) IE 506, 2 octets, unsigned

The largest payload length transferred in the flow.

=item B<standardDeviationPayloadLength> CERT (PEN 6871) IE 508, 2 octets, unsigned

The standard deviation of the payload length for up to the first 10 non empty
packets.

=item B<firstEightNonEmptyPacketDirections> CERT (PEN 6871) IE 507, 1 octet, unsigned

Represents directionality for the first 8 non-empty packets. 0 for forward
direction, 1 for reverse direction.

=item B<reverseDataByteCount> CERT (PEN 6871) IE 16886, 8 octets, unsigned

Total bytes transferred as payload in the reverse direction.

=item B<reverseAverageInterarrivalTime> CERT (PEN 6871) IE 16887, 8 octets, unsigned

Average number of milliseconds between packets in reverse direction.

=item B<reverseStandardDeviationInterarrivalTime> CERT (PEN 6871) IE 16888, 8 octets, unsigned

Standard deviation of the interarrival time for up to the first ten packets
in the reverse direction.

=item B<reverseTcpUrgTotalCount> CERT (PEN 6871) IE 16896, 4 octets, unsigned

The number of TCP packets that have the URGENT Flag set in the reverse
direction.

=item B<reverseSmallPacketCount> CERT (PEN 6871) IE 16884, 4 octets, unsigned

The number of packets that contain less than 60 bytes of payload in reverse
direciton.

=item B<reverseNonEmptyPacketCount> CERT (PEN 6871) IE 16885, 4 octets, unsigned

The number of packets that contain at least 1 byte of payload in reverse
direction.

=item B<reverseLargePacketCount> CERT (PEN 6871) IE 16894, 4 octets, unsigned

The number of packets that contain at least 220 bytes of payload in the
reverse direction.

=item B<reverseFirstNonEmptyPacketSize> CERT (PEN 6871) IE 16889, 2 octets, unsigned

Payload length of the first non-empty packet in the reverse direction.

=item B<reverseMaxPacketSize> CERT (PEN 6871) IE 16890, 2 octets, unsigned

The largest payload length transferred in the flow in the reverse direction.

=item B<reverseStandardDeviationPayloadLength> CERT (PEN 6871) IE 16892, 2 octets, unsigned

The standard deviation of the payload length for up to the first 10 non empty
packets in the reverse direction.

=back

=head2 Statistics Option Template

B<yaf> will export information about its process periodically
using IPFIX Options Template Record.  This record gives information
about the status of the flow and fragment table, as well as decoding
information.  This can be turned off using the B<--no-stats> option.
The following Information Elements will be exported:

=over 4

=item B<systemInitTimeMilliseconds> IE 161, 8 octets, unsigned

The time in milliseconds of the last (re-)initialization of B<yaf>.

=item B<exportedFlowRecordTotalCount> IE 42, 8 octets, unsigned

Total amount of exported flows from B<yaf> start time.

=item B<packetTotalCount> IE 86, 8 octets, unsigned

Total amount of packets processed by B<yaf> from B<yaf> start time.

=item B<droppedPacketTotalCount> IE 135, 8 octets, unsigned

Total amount of dropped packets according to statistics given
by libpcap, libdag, or libpcapexpress.

=item B<ignoredPacketTotalCount> IE 164, 8 octets, unsigned

Total amount of packets ignored by the B<yaf> packet decoder, such as
unsupported packet types and incomplete headers, from B<yaf>
start time.

=item B<notSentPacketTotalCount> IE 167, 8 octets, unsigned

Total amount of packets rejected by B<yaf> because they were received
out of sequence.

=item B<expiredFragmentCount> CERT (PEN 6871) IE 100, 4 octets, unsigned

Total amount of fragments that have been expired since B<yaf>
start time.

=item B<assembledFragmentCount> CERT (PEN 6871) IE 101, 4 octets, unsigned

Total number of packets that been assembled from a series of
fragments since B<yaf> start time.

=item B<flowTableFlushEventCount> CERT (PEN 6871) IE 104, 4 octets, unsigned

Total number of times the B<yaf> flow table has been flushed
since B<yaf> start time.

=item B<flowTablePeakCount> CERT (PEN 6871) IE 105, 4 octets, unsigned

The maximum number of flows in the B<yaf> flow table at any
one time since B<yaf> start time.

=item B<exporterIPv4Address> IE 130, 4 octets, unsigned

The IPv4 Address of the B<yaf> flow sensor.

=item B<exportingProcessId> IE 144, 4 octets, unsigned

Set the ID of the B<yaf> flow sensor by giving a value to
B<--observation-domain>.  The default is 0.

=item B<meanFlowRate> CERT (PEN 6871) IE 102, 4 octets, unsigned

The mean flow rate of the B<yaf> flow sensor since B<yaf> start time,
rounded to the nearest integer.

=item B<meanPacketRate> CERT (PEN 6871) IE 103, 4 octets, unsigned

The mean packet rate of the B<yaf> flow sensor since B<yaf> start time,
rounded to the nearest integer.

=back

=head1 SIGNALS

B<yaf> responds to B<SIGINT> or B<SIGTERM> by terminating input processing,
flushing any pending flows to the current output, and exiting. If B<--verbose>
is given, B<yaf> responds to B<SIGUSR1> by printing present flow and fragment table
statistics to its log.  All other signals are handled by the C runtimes in
the default manner on the platform on which B<yaf> is currently operating.

=head1 EXAMPLES

To generate flows from an pcap file into an IPFIX file:

C<yaf --in packets.pcap --out flows.yaf>

To capture flows from a pcap interface and export them to files in the
current directory rotated hourly:

C<yaf --live pcap --in en1 --out en1_capture --rotate 3600>

To capture flows from an Endace DAG card and export them via IPFIX over TCP:

C<yaf --live dag --in dag0 --ipfix tcp --out my-collector.example.com>

To convert a pcap formatted packet capture and convert that into IPFIX:

C<yaf E<lt>packets.pcap E<gt>flows.yaf>

To publish to spread group B<TST_SPRD> for a spread daemon running locally on port 4803:

C<yaf --live pcap --in eth1 --out 4803@localhost --ipfix spread --group TST_SPRD>

To publish to spread groups based on application label for spread daemon running locally on port 4803:

C<yaf --live pcap --in eth1 --out 4803@localhost --ipfix spread --group "SPRD_CATCHALL, SPRD_DNS:53, SPRD_HTTP:80, SPRD_SMTP:25" --groupby applabel --applabel --max-payload=400>

To run B<yaf> with application labeling enabled and export via IPFIX over TCP:

C<yaf --live pcap --in eth1 --out 127.0.0.1 --ipfix tcp --ipfix-port=18001 --applabel --applabel-rules=/usr/local/etc/yafApplabelRules.conf --max-payload=300>

To run B<yaf> with BPF on UDP Port 53

C<yaf --live pcap --in en1 --out /path/to/dst/ --rotate 120 --filter="udp port 53">

To run B<yaf> with Deep Packet Inspection enabled for HTTP, IMAP, and DNS:

C<yaf --in packets.pcap --out flows.yaf --applabel --max-payload=400 --plugin-name=/usr/local/lib/dpacketplugin.la --plugin-opts="80 143 53">

To run B<yaf> with Deep Packet Inspection and DHCP Fingerprinting:

C<yaf --in packets.pcap --out flows.yaf --applabel --max-payload=1000 --plugin-name=/usr/local/lib/dpacketplugin.la,/usr/local/lib/dhcp_fp_plugin.la>

To run B<yaf> with pcap generation:

C<yaf --in eth0 --live pcap --out localhost --ipfix tcp --ipfix-port=18001 --pcap /data/pcap --pcap-meta-file=/data/pcap_info.txt>

=head1 KNOWN ISSUES

YAF BPF Filtering does not operate with the Bivio Zero-Copy Library.

YAF BPF Filtering is ignored when using B<--live> I<dag> or I<napatech>
because libpcap is not used.

YAF PCAP Export options are ignored when using B<--live> I<dag> or I<napatech>.

YAF 2.x requires libfixbuf 1.0.0 or later.

YAF 2.0 will not interoperate with the SiLK tools unless B<--silk> is used, due
to the TCP Information Elements being nested in the subTemplateMultiList.
YAF 2.0 must be used with an IPFIX Collecting Process that can handle IPFIX lists elements, especially the subTemplateMultiList Information Element in order to retrieve certain flow information.  Older versions of YAF can read YAF 2.0 flow files, but will ignore anything contained in the subTemplateMultiList.

The plugin infrastructure has been modified in YAF 2.0 to export templates
in YAF's subTemplateMultiList element.

YAF 2.0 will export statistics in an Options Template and Options Data Records
unless the B<--no-stats> switch is given.  The IPFIX Collecting Process should be
able to differentiate between options records and flow records in order to
prevent incorrect transcoding of statistics records into flow records.

YAF will not rotate output files if it is not seeing any flow data.  However,
it will continue to write process statistics messages at the configured
interval time to the most recent output file.

Presently, the B<destinationTransportPort> information element contains
ICMP type and code information for ICMP or ICMP6 flows; this is nonstandard
and may not be interoperable with other IPFIX implementations.

Bug reports and feature requests may be sent via email to
E<lt>netsa-help@cert.orgE<gt>.

=head1 AUTHORS

Brian Trammell, Chris Inacio,
Michael Duggan, Emily Sarneso, Dan Ruef,
and the CERT Network Situational Awareness Group Engineering Team,
E<lt>http://www.cert.org/netsaE<gt>.

=head1 SEE ALSO

B<yafscii(1)>, B<tcpdump(1)>, B<pcap(3)>, B<nafalize(1)>, Spread Documentation at www.spread.org, libp0f at E<lt>https://tools.netsa.cert.org/confluence/display/tt/libp0fE<gt>, and the following IETF
Internet RFCs: Specification of the IPFIX Protocol for the Exchange of IP
Traffic Flow Information B<RFC 5101>, Information Model for IP Flow Information
Export B<RFC 5102>, Bidirectional Flow Export using IPFIX B<RFC 5103>, Export of
Structured Data in IPFIX B<RFC 6313>

=cut
